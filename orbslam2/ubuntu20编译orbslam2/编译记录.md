# 安装Pangolin-0.5

参考链接 https://blog.csdn.net/Robert_Q/article/details/121690089

1、安装Pangolin要求的依赖，按照官网安装即可
2、clone Pangolin 并且切换到0.5版本

    mkdir build

    cd build 

    cmake ..

    make 

编译，报错:

### error: ‘AV_PIX_FMT_XVMC_MPEG2_MC’ was not declared in this scope

参考issue https://github.com/stevenlovegrove/Pangolin/pull/318/files?diff=split&w=0

解决办法

在``/Pangolin/CMakeModules/FindFFMPEG.cmake``中63,64行，将

        sizeof(AVFormatContext::max_analyze_duration2);
      }" HAVE_FFMPEG_MAX_ANALYZE_DURATION2
替换为：
        sizeof(AVFormatContext::max_analyze_duration);
      }" HAVE_FFMPEG_MAX_ANALYZE_DURATION

在``/Pangolin/src/video/drivers/ffmpeg.cpp``中:

第37行 ``namespace pangolin``上面加上

    #define CODEC_FLAG_GLOBAL_HEADER AV_CODEC_FLAG_GLOBAL_HEADER

第78,79行

    TEST_PIX_FMT_RETURN(XVMC_MPEG2_MC); 
    TEST_PIX_FMT_RETURN(XVMC_MPEG2_IDCT);

改为：

    #ifdef FF_API_XVMC
        TEST_PIX_FMT_RETURN(XVMC_MPEG2_MC);
        TEST_PIX_FMT_RETURN(XVMC_MPEG2_IDCT);
    #endif

101-105行

    TEST_PIX_FMT_RETURN(VDPAU_H264);
    TEST_PIX_FMT_RETURN(VDPAU_MPEG1);
    TEST_PIX_FMT_RETURN(VDPAU_MPEG2);
    TEST_PIX_FMT_RETURN(VDPAU_WMV3);
    TEST_PIX_FMT_RETURN(VDPAU_VC1);

改为：

    #ifdef FF_API_VDPAU
        TEST_PIX_FMT_RETURN(VDPAU_H264);
        TEST_PIX_FMT_RETURN(VDPAU_MPEG1);
        TEST_PIX_FMT_RETURN(VDPAU_MPEG2);
        TEST_PIX_FMT_RETURN(VDPAU_WMV3);
        TEST_PIX_FMT_RETURN(VDPAU_VC1);
    #endif

127行：

	TEST_PIX_FMT_RETURN(VDPAU_MPEG4);

改为：

    #ifdef FF_API_VDPAU
        TEST_PIX_FMT_RETURN(VDPAU_MPEG4);
    #endif

### error: ‘AVFMT_RAWPICTURE’ was not declared in this scope

在``Pangolin/include/pangolin/video/drivers/ffmpeg.h``开头加上

    #define AV_CODEC_FLAG_GLOBAL_HEADER (1 << 22)
    #define CODEC_FLAG_GLOBAL_HEADER AV_CODEC_FLAG_GLOBAL_HEADER
    #define AVFMT_RAWPICTURE 0x0020


# eigen3 二进制安装即可


# opencv 编译报错

ros noetic 版本自带opencv4.2， 所以使用opencv4来编译orbslam3

1、将编译的opencv依赖换成opcv4.2。这里一共有三个CmakeLists需要改

    find_package(OpenCV 4.2 QUIET)
    if(NOT OpenCV_FOUND)
        find_package(OpenCV 2.4.3 QUIET)
        if(NOT OpenCV_FOUND)
        message(FATAL_ERROR "OpenCV > 2.4.3 not found.")
        endif()
    endif()

2、#include <opencv/cv.h>的错误

将 ``#include <opencv/cv.h>`` 替换为：

    #include<opencv2/imgproc/imgproc_c.h>
    #include <opencv2/highgui/highgui_c.h>

3、CV_LOAD_IMAGE_UNCHANGED的错误

将``CV_LOAD_IMAGE_UNCHANGED``替换为cv::IMREAD_UNCHANGED


4、C++报错

/usr/include/c++/9/bits/stl_map.h:122:71: error: static assertion failed: std::map must have the same value_type as its allocator
122 | static_assert(is_same<typename _Alloc::value_type, value_type>::value,
| ^~~~~

将这一句

    typedef map<KeyFrame*,g2o::Sim3,std::less<KeyFrame*>,
        Eigen::aligned_allocator<std::pair<const KeyFrame*, g2o::Sim3> > > KeyFrameAndPose;

改为：

    typedef map<KeyFrame*,g2o::Sim3,std::less<KeyFrame*>,
            Eigen::aligned_allocator<std::pair<KeyFrame *const, g2o::Sim3> > > KeyFrameAndPose;


# rosdep的问题

找不到命令，安装rosdep：

    sudo apt install python3-rosdep

千万不能使用：``sudo apt install python3-rosdep2``

# 其他问题参考链接

还有一些其他的bug可能遇到，参考

https://blog.csdn.net/weixin_42584917/article/details/111308873

https://blog.csdn.net/qq_29710939/article/details/119961882